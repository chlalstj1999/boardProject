<!DOCTYPE html>
<html lang="kr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <a href="http://localhost/mainPage">게시판 보기</a>
    <input id="idValue" type="text" />
    <input id="pwValue" type="text" />
    <input
      id="loginButton"
      type="button"
      value="로그인"
      onclick="loginEvent()"
    />
    <input
      id="googleLoginButton"
      type="button"
      value="googleLogin"
      onclick="googleLoginEvent()"
    />
    <input
      id="kakaoLoginButton"
      type="button"
      value="kakaoLogin"
      onclick="kakaoLoginEvent()"
    />
    <input
      id="naverLoginButton"
      type="button"
      value="naverLogin"
      onclick="naverLoginEvent()"
    />

    <script>
      async function loginEvent() {
        const idValue = document.getElementById("idValue").value;
        const pwValue = document.getElementById("pwValue").value;

        const response = await fetch("/users/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            idValue: idValue,
            pwValue: pwValue,
          }),
        });

        if (response.status === 200) {
          const result = await response.json();
          location.href = `http://localhost/mainPage?accessToken=${result.accessToken}`;
        }

        if (response.status === 400) {
          alert("아이디 또는 비밀번호 입력값을 확인해주세요");
        }

        if (response.status === 404) {
          alert("아이디 또는 비밀번호가 틀렸습니다.");
        }
      }

      async function googleLoginEvent() {
        location.href = "http://localhost/users/login/google";
      }

      window.onload = function () {
        let queryString = location.search;

        if (queryString) {
          const urlParams = new URLSearchParams(queryString);

          if (confirm("회원가입 하시겠습니까?")) {
            location.href = `http://localhost/oauthSignUpPage?userName=${urlParams.get(
              "userName"
            )}&email=${urlParams.get("email")}&signUpPath=${urlParams.get(
              "signUpPath"
            )}`;
          }
        }
      };
    </script>
  </body>
</html>
